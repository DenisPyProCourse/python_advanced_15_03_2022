[![Django CI](https://github.com/python-hillel/django_quiz/actions/workflows/action.yml/badge.svg?branch=main)](https://github.com/python-hillel/django_quiz/actions/workflows/action.yml)

# Django QUIZ

## Технические требования  
### Web-UI
  1. Регистрация
      - [x] регистрация (с подтверждением по email)
      - [x] авторизация
      - [x] смена пароля
      - [x] сброс пароля
    
  2. Возможности пользователя
      - [x] прохождение любого теста
      - [x] последовательно проходить вопросы теста (один за другим)
      - [x] завершение отложенного теста
      - [x] удаление незавершенного теста 
      - [x] просмотр результатов
    
  3. После завершения теста
      - [x] отчет о ко-ве правильных и неправильных ответов
      - процент правильных ответов

### Admin site
  1. [x] Управление пользователями
  2. [x] Управление тестами
      - [x] добавление теста
      - [x] изменить тест
      - [x] удаление теста
      - [x] валидация теста
        - [x] нельзя сохранить вопрос:
            - [x] без указания правильного ответа
            - [x] в которых все ответы правильные
        - [x] нельзя сохранить тест если:
            - [x] некорректный order_num (должен быть от 1 до 100 и увеличиваться на 1)
            - [x] максимальное значение order_num не более максимально допустимого кол-ва вопросов
            - [x] кол-во вопросов менее 3 или более 100

### Дополнительные требования
1. [x] Проект должен быть на Git-е
2. [x] Наличие файла requirements.txt
3. [x] venv
4. [ ] PostgreSQL
5. [x] Наличие дампа данных
6. [x] bootstrap
7. [ ] API + Tests
8. [ ] Docker image
9. [ ] Кэширование 
10. [ ] Планировщик
11. [ ] Деплой на Amazon

## DB - Schema
![db](db_schema.jpg)


## Lesson 01
- Создаём GIT репозиторий, клонируем его
- В клонированном репо создаём проект
- Устанавливаем Django и все необходимые зависимости
- Создаём приложения:
  - **accounts**
  - **quiz**
- Настраиваем проект
- Переопределяем модель **User**
- Создаём формы регистрации и редактирования пользователя
- Создаём view регистрации, активации и успешной активации
- Для отправки письма с приглашением активировать аккаунт, используем созданный сигнал
- Сообщаем Django о новой модели пользователя

## Lesson 02
- Добавили 
  - шаблоны для приложения **Accounts**
  - базовый (**base.html**) и индексный (**index.html**) шаблоны
  - навигационную панель (**nav_bat.html**)
  - модель **CustomUser** в админку
- Добавили **Login**, **Logout**, **Profile**, **UpdateProfile**
- Создали маршрутизатор приложения Accounts и добавили его в главный маршрутизатор
- Для обработки статических и медиа файлов в главный маршрутизатор добавили настройку
  ```python
  if settings.DEBUG:
      urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
      urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)
  ```
- Определили модели приложения **Quiz**
  - **BaseModel**
  - **Exam**
  - **Question**
  - **Choice**
  - **Result**
- Создали **FormSet**'s для обработки инлайн таблиц моделей **Question** и **Choice** в админке
- Добавили модели **Exam**, **Question**, **Choice** и **Result**  админку
- Создали валидаторы вопросов и один валидатор тестов

## Lesson 03
- Добавляем view для работы с тестом
  - **ExamListView**
  - **ExamDetailView**
- Для получения детальной информации о тесте необходимо переопределить метод **get_object** который пытается получить 
  объект по ID, но так как мы выбираем тест по **uuid** надо это сделать самому.
- Добавили шаблоны для отображения списка тестов (**list.html**) и отображения детальной информации по 
  тесту (**details.html**)
- Так же, определили необходимые маршруты
- Создаём view для запуска теста **ExamResultCreateView**
  - переопределяем метод **post**
- Для отображения вопроса и обработки ответа определяем view **ExamResultQuestionView**
  - так же необходимо переопределить методы **post** и **get**
  - добавляем **FormSet** (**ChoicesFormSet**) со списком ответов
- Создаем view **ExamResultDetailView** для отображения результатов теста
  - будет необходимо переопределить метод **get_object**
- Создаём необходимые маршруты
- Добавляем атрибут **action** в форму запуска теста (шаблон **exam/details.html**)
- Выводим список попыток прохождения теста
  - на страницу детализации теста добавим список о всех попытках прохождения теста
  - в шаблон **exam/details.html** добавляем таблицу для отображения результатов
  - обновляем view (**ExamDetailView**) для отображения результатов тестирования по выбранному тесту
- Возобновление незавершенного теста
  - создаём view - **ExamResultUpdateView**
  - добавляем инициализацию поля **current_order_number** в модели **Result**
    - в настройках поля модели добавляем атрибут **default=0** или
    - в view **ExamResultCreateView** при создании новой записи, инициализируем это поле
  - создаём нужный маршрут

## Lesson 04
- Убираем id вопроса из URL и отключаем возможность перехода на страницу назад
  - меняем маршрут с 
  ```python
  path('<uuid:uuid>/result/<uuid:res_uuid>/question/<int:order_num>/', ExamResultQuestionView.as_view(), name='question'),
  ```
  на
  ```python
  path('<uuid:uuid>/result/<uuid:res_uuid>/question/next/', ExamResultQuestionView.as_view(), name='question'),
  ```
  - убираем передачу **order_num** в маршруты для view **ExamResultCreateView**
  - удаляем получение **order_num** из маршрута
    - **ExamResultCreateView**
    - **ExamResultQuestionView**
    - **ExamResultUpdateView**
  - используем **current_order_number** для перехода по вопросам
- Добавляем пагинатор в таблицу результатов
  - в **ExamDetailView** добавляем миксин **MultipleObjectMixin**, чтоб включить пагинатор
  - добавляем атрибут **paginate_by**
  - переопределяем **get_queryset**
  - изменяем **get_context_data**
  - подключаем пагинатор в шаблоне
- Создаём свои шаблонные теги и фильтры
  - пример применения встроенного фильтра для поля "Дата старта" на странице теста
  ```html
  <td>{{ result.create_timestamp|date:'d-m-Y H:i' }}</td>
  ```
  - создаём свой фильтр **negative** и применяем его в шаблоне **question.html**
  - добавляем на страницу вопроса прогресс бар для отображения процесса прохождения теста
  - для работы прогресс бара добавляем ещё два фильтра **multi** и **dived**
  - использую созданные фильтры строем вычисления для работы прогресс бара
  ```html
  {% with question.order_num|add:-1|multi:100|dived:question.exam.questions_count as progress_level %}
  ```
  - так же, добавляем свой таг - **expression** и используем его для прогресс бара вместо тага **with**

## Lesson 05
- Permissions (разрешения)
  - настраиваем добавление нового пользователя (при регистрации) в определённую группу
  - использование существующих разрешений для групп и пользователей
  - как использовать разрешения в шаблонах
  - как создать своё разрешение
  - как использовать разрешения в view

- Тестирование
  - тесты для models
  - тесты для forms
  - тесты для urls
  - тесты для views